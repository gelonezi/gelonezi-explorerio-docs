# Search Functionality

> ⚠️ **Warning:** This file was generated by AI and has not been reviewed yet.

ExplorerIO provides powerful search capabilities that allow users to quickly find and explore data across all integrated sources. The search system is built on Elasticsearch and offers full-text search, filtering, and advanced analytics.

## Search Overview

The search functionality in ExplorerIO includes:

- Full-text search across all data sources
- Advanced filtering and faceted search
- Real-time search suggestions and auto-complete
- Search analytics and performance monitoring
- Customizable search interfaces
- API-driven search capabilities

## Search Features

### Full-Text Search

**Basic Search**: Simple keyword search across all indexed content
```bash
GET /api/search?q=customer+analytics
```

**Advanced Search**: Use operators and field-specific searches
```bash
GET /api/search?q=title:"analytics report" AND author:john
```

### Faceted Search

**Category Filters**: Filter results by predefined categories
```json
{
  "query": "sales data",
  "filters": {
    "category": ["reports", "dashboards"],
    "date_range": {
      "start": "2024-01-01",
      "end": "2024-12-31"
    },
    "author": ["john.doe", "jane.smith"]
  }
}
```

### Search Suggestions

**Auto-complete**: Real-time suggestions as users type
```bash
GET /api/search/suggest?q=analyt
```
Response:
```json
{
  "suggestions": [
    "analytics",
    "analytical",
    "analytics report",
    "analytics dashboard"
  ]
}
```

## Search Configuration

### Index Settings

**Elasticsearch Configuration**:
```yaml
# elasticsearch.yml
cluster.name: explorerio-search
node.name: search-node-1
path.data: /var/lib/elasticsearch
path.logs: /var/log/elasticsearch
network.host: 0.0.0.0
http.port: 9200
discovery.type: single-node

# Index settings
index:
  number_of_shards: 3
  number_of_replicas: 1
  refresh_interval: 30s
  max_result_window: 10000
```

### Data Indexing

**Index Mapping**:
```json
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "standard",
        "fields": {
          "keyword": {
            "type": "keyword",
            "ignore_above": 256
          }
        }
      },
      "content": {
        "type": "text",
        "analyzer": "standard"
      },
      "category": {
        "type": "keyword"
      },
      "tags": {
        "type": "keyword"
      },
      "created_at": {
        "type": "date"
      },
      "author": {
        "type": "keyword"
      },
      "metadata": {
        "type": "object",
        "enabled": false
      }
    }
  }
}
```

### Search Analyzers

**Custom Analyzers**:
```json
{
  "settings": {
    "analysis": {
      "analyzer": {
        "custom_standard": {
          "type": "custom",
          "tokenizer": "standard",
          "filter": [
            "lowercase",
            "stop",
            "snowball"
          ]
        },
        "autocomplete": {
          "type": "custom",
          "tokenizer": "keyword",
          "filter": [
            "lowercase",
            "edge_ngram"
          ]
        }
      },
      "filter": {
        "edge_ngram": {
          "type": "edge_ngram",
          "min_gram": 2,
          "max_gram": 20
        }
      }
    }
  }
}
```

## Search API

### Basic Search

**Simple Search**:
```bash
GET /api/search
```
Parameters:
- `q`: Search query
- `limit`: Number of results (default: 20, max: 100)
- `offset`: Result offset for pagination
- `sort`: Sort field and direction

Example:
```bash
GET /api/search?q=analytics&limit=50&offset=0&sort=created_at:desc
```

### Advanced Search

**Complex Search with Filters**:
```bash
POST /api/search/advanced
{
  "query": {
    "bool": {
      "must": [
        {
          "multi_match": {
            "query": "analytics dashboard",
            "fields": ["title^2", "content", "tags"]
          }
        }
      ],
      "filter": [
        {
          "range": {
            "created_at": {
              "gte": "2024-01-01",
              "lte": "2024-12-31"
            }
          }
        },
        {
          "terms": {
            "category": ["reports", "dashboards"]
          }
        }
      ]
    }
  },
  "sort": [
    {"_score": {"order": "desc"}},
    {"created_at": {"order": "desc"}}
  ],
  "highlight": {
    "fields": {
      "title": {},
      "content": {}
    }
  }
}
```

### Search Aggregations

**Faceted Search Results**:
```bash
POST /api/search/facets
{
  "query": {
    "match": {"content": "analytics"}
  },
  "aggs": {
    "categories": {
      "terms": {
        "field": "category",
        "size": 10
      }
    },
    "authors": {
      "terms": {
        "field": "author",
        "size": 20
      }
    },
    "date_histogram": {
      "date_histogram": {
        "field": "created_at",
        "calendar_interval": "month"
      }
    }
  }
}
```

## Search Performance

### Query Optimization

**Performance Best Practices**:

1. **Use Filters Instead of Queries**: Filters are cached and faster
2. **Limit Result Size**: Use pagination instead of large result sets
3. **Optimize Field Selection**: Only return needed fields
4. **Use Appropriate Analyzers**: Choose the right analyzer for your data

**Optimized Query Example**:
```json
{
  "query": {
    "bool": {
      "filter": [
        {"term": {"category": "reports"}},
        {"range": {"created_at": {"gte": "2024-01-01"}}}
      ],
      "must": [
        {"match": {"title": "analytics"}}
      ]
    }
  },
  "_source": ["title", "author", "created_at", "url"],
  "size": 20
}
```

### Caching Strategy

**Query Result Caching**:
```bash
# Enable query cache
PUT /explorerio_index/_settings
{
  "index.queries.cache.enabled": true
}

# Request-level caching
POST /api/search
{
  "query": {...},
  "request_cache": true
}
```

### Search Performance Monitoring

**Key Metrics**:
- Search latency (p50, p95, p99)
- Query throughput (queries per second)
- Index size and growth rate
- Cache hit ratio
- Slow query identification

**Monitoring Configuration**:
```bash
# Enable slow query logging
PUT /_cluster/settings
{
  "transient": {
    "index.search.slowlog.threshold.query.warn": "10s",
    "index.search.slowlog.threshold.query.info": "5s",
    "index.search.slowlog.threshold.query.debug": "2s"
  }
}
```

## Search UI Components

### Search Bar Component

**Basic Search Interface**:
```javascript
// React component example
import React, { useState, useEffect } from 'react';
import { searchAPI } from './api';

function SearchBar({ onResults }) {
  const [query, setQuery] = useState('');
  const [suggestions, setSuggestions] = useState([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const fetchSuggestions = async () => {
      if (query.length > 2) {
        const response = await searchAPI.suggest(query);
        setSuggestions(response.suggestions);
      }
    };

    const debounceTimer = setTimeout(fetchSuggestions, 300);
    return () => clearTimeout(debounceTimer);
  }, [query]);

  const handleSearch = async () => {
    setLoading(true);
    try {
      const results = await searchAPI.search({ q: query });
      onResults(results);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="search-bar">
      <input
        type="text"
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder="Search..."
      />
      {suggestions.length > 0 && (
        <ul className="suggestions">
          {suggestions.map((suggestion, index) => (
            <li key={index} onClick={() => setQuery(suggestion)}>
              {suggestion}
            </li>
          ))}
        </ul>
      )}
      <button onClick={handleSearch} disabled={loading}>
        {loading ? 'Searching...' : 'Search'}
      </button>
    </div>
  );
}
```

### Filter Components

**Faceted Filter Interface**:
```javascript
function SearchFilters({ facets, selectedFilters, onFilterChange }) {
  return (
    <div className="search-filters">
      {Object.entries(facets).map(([facetName, buckets]) => (
        <div key={facetName} className="filter-group">
          <h4>{facetName}</h4>
          {buckets.map((bucket) => (
            <label key={bucket.key}>
              <input
                type="checkbox"
                checked={selectedFilters[facetName]?.includes(bucket.key)}
                onChange={(e) => onFilterChange(facetName, bucket.key, e.target.checked)}
              />
              {bucket.key} ({bucket.doc_count})
            </label>
          ))}
        </div>
      ))}
    </div>
  );
}
```

## Search Analytics

### Search Tracking

**Search Event Logging**:
```javascript
// Track search events
const trackSearch = (query, results, timestamp) => {
  analytics.track('search_performed', {
    query: query,
    results_count: results.length,
    timestamp: timestamp,
    user_id: getCurrentUserId(),
    session_id: getSessionId()
  });
};

// Track result interactions
const trackResultClick = (query, result, position) => {
  analytics.track('search_result_clicked', {
    query: query,
    result_id: result.id,
    result_title: result.title,
    position: position,
    timestamp: Date.now()
  });
};
```

### Search Analytics Dashboard

**Popular Searches**:
```sql
SELECT 
  query,
  COUNT(*) as search_count,
  AVG(results_count) as avg_results
FROM search_events 
WHERE timestamp >= NOW() - INTERVAL '30 days'
GROUP BY query
ORDER BY search_count DESC
LIMIT 10;
```

**Search Performance Metrics**:
```sql
SELECT 
  DATE(timestamp) as date,
  AVG(response_time_ms) as avg_response_time,
  COUNT(*) as total_searches,
  COUNT(*) FILTER (WHERE results_count = 0) as zero_result_searches
FROM search_events 
WHERE timestamp >= NOW() - INTERVAL '7 days'
GROUP BY DATE(timestamp)
ORDER BY date;
```

## Advanced Search Features

### Semantic Search

**Vector-based Search**:
```bash
POST /api/search/semantic
{
  "query": "find reports about customer satisfaction",
  "model": "sentence-transformers",
  "similarity_threshold": 0.7,
  "size": 10
}
```

### Search Templates

**Saved Search Queries**:
```json
{
  "name": "monthly_reports",
  "description": "Find all monthly reports",
  "template": {
    "query": {
      "bool": {
        "must": [
          {"match": {"category": "reports"}},
          {"match": {"title": "monthly"}}
        ],
        "filter": [
          {
            "range": {
              "created_at": {
                "gte": "{{start_date}}",
                "lte": "{{end_date}}"
              }
            }
          }
        ]
      }
    }
  },
  "parameters": {
    "start_date": {
      "type": "date",
      "required": true
    },
    "end_date": {
      "type": "date",
      "required": true
    }
  }
}
```

### Real-time Search

**Live Search Updates**:
```javascript
// WebSocket connection for real-time search updates
const searchSocket = new WebSocket('ws://localhost:8080/search/live');

searchSocket.onmessage = (event) => {
  const update = JSON.parse(event.data);
  if (update.type === 'new_document') {
    // Update search results if relevant
    updateSearchResults(update.document);
  }
};

// Subscribe to search updates
searchSocket.send(JSON.stringify({
  action: 'subscribe',
  query: currentSearchQuery,
  filters: currentFilters
}));
```

## Search Security

### Access Control

**Search Result Filtering**:
```json
{
  "query": {
    "bool": {
      "must": [...],
      "filter": [
        {
          "terms": {
            "access_level": ["public", "internal"]
          }
        },
        {
          "terms": {
            "department": ["engineering", "product"]
          }
        }
      ]
    }
  }
}
```

### Data Masking

**Sensitive Data Protection**:
```javascript
// Mask sensitive data in search results
const maskSensitiveData = (results, userPermissions) => {
  return results.map(result => {
    if (!userPermissions.includes('view_sensitive_data')) {
      result.content = result.content.replace(/\b\d{3}-\d{2}-\d{4}\b/g, 'XXX-XX-XXXX');
      result.email = result.email.replace(/(.{2}).*@/, '$1***@');
    }
    return result;
  });
};
```

## Troubleshooting

### Common Search Issues

1. **No Results Found**: Check indexing status and query syntax
2. **Slow Search Performance**: Optimize queries and check index health
3. **Relevance Issues**: Tune scoring and field weights
4. **Memory Issues**: Monitor heap usage and adjust settings

### Search Debugging

**Debug Query Performance**:
```bash
POST /explorerio_index/_search?explain=true
{
  "query": {
    "match": {"title": "analytics"}
  }
}
```

**Index Health Check**:
```bash
GET /_cluster/health
GET /explorerio_index/_stats
GET /_cat/indices?v
```

## Next Steps

- Learn about [Cached Data](cached-data.md) to optimize search performance
- Explore [User Interface](user-interface.md) components for search
- Check the [API Documentation](../api/overview.md) for detailed search endpoints
