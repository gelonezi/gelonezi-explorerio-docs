# Authentication

> ⚠️ **Warning:** This file was generated by AI and has not been reviewed yet.

ExplorerIO provides a comprehensive authentication system that supports multiple authentication methods and robust security features. This document covers all aspects of user authentication and authorization.

## Overview

The authentication system in ExplorerIO is designed with security, flexibility, and user experience in mind. It supports various authentication methods and provides fine-grained access control through role-based permissions.

### Key Features

- Multiple authentication providers (local, OAuth, LDAP)
- JSON Web Token (JWT) based session management
- Role-based access control (RBAC)
- Multi-factor authentication (MFA)
- Session management and security
- Password policies and enforcement
- Account lockout protection

## Authentication Methods

### 1. Local Authentication

The default authentication method using username and password stored in the ExplorerIO database.

**Features**:
- Secure password hashing using bcrypt
- Configurable password policies
- Account lockout after failed attempts
- Password reset functionality

**Configuration**:
```bash
# Enable local authentication
AUTH_LOCAL_ENABLED=true

# Password policy settings
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SYMBOLS=true

# Account lockout settings
ACCOUNT_LOCKOUT_ENABLED=true
ACCOUNT_LOCKOUT_MAX_ATTEMPTS=5
ACCOUNT_LOCKOUT_DURATION=300  # 5 minutes
```

### 2. OAuth Authentication

Support for popular OAuth providers for single sign-on functionality.

#### Supported Providers

**Google OAuth**:
```bash
OAUTH_GOOGLE_ENABLED=true
OAUTH_GOOGLE_CLIENT_ID=your-google-client-id
OAUTH_GOOGLE_CLIENT_SECRET=your-google-client-secret
```

**GitHub OAuth**:
```bash
OAUTH_GITHUB_ENABLED=true
OAUTH_GITHUB_CLIENT_ID=your-github-client-id
OAUTH_GITHUB_CLIENT_SECRET=your-github-client-secret
```

**Microsoft Azure AD**:
```bash
OAUTH_AZURE_ENABLED=true
OAUTH_AZURE_CLIENT_ID=your-azure-client-id
OAUTH_AZURE_CLIENT_SECRET=your-azure-client-secret
OAUTH_AZURE_TENANT_ID=your-tenant-id
```

#### OAuth Configuration Steps

1. **Register Application**: Register your ExplorerIO instance with the OAuth provider
2. **Configure Redirect URI**: Set the callback URL to `https://your-domain.com/auth/oauth/callback`
3. **Set Environment Variables**: Add the client credentials to your environment configuration
4. **Enable Provider**: Set the enabled flag for your chosen provider

### 3. LDAP Authentication

Enterprise LDAP/Active Directory integration for organizations.

**Configuration**:
```bash
LDAP_ENABLED=true
LDAP_URL=ldap://your-ldap-server:389
LDAP_BIND_DN=cn=admin,dc=company,dc=com
LDAP_BIND_PASSWORD=admin-password
LDAP_SEARCH_BASE=ou=users,dc=company,dc=com
LDAP_SEARCH_FILTER=(uid={{username}})
LDAP_USERNAME_ATTRIBUTE=uid
LDAP_EMAIL_ATTRIBUTE=mail
LDAP_FIRST_NAME_ATTRIBUTE=givenName
LDAP_LAST_NAME_ATTRIBUTE=sn
```

## JWT Token Management

### Token Structure

ExplorerIO uses JSON Web Tokens (JWT) for session management. Each token contains:

```json
{
  "sub": "user-id",
  "email": "user@example.com",
  "roles": ["user", "analyst"],
  "permissions": ["read:data", "write:reports"],
  "iat": 1640995200,
  "exp": 1641081600,
  "iss": "explorerio",
  "aud": "explorerio-web"
}
```

### Token Configuration

```bash
# JWT settings
JWT_SECRET=your-jwt-secret-key
JWT_EXPIRY=24h
JWT_REFRESH_EXPIRY=7d
JWT_ISSUER=explorerio
JWT_AUDIENCE=explorerio-web

# Token refresh settings
JWT_REFRESH_ENABLED=true
JWT_REFRESH_THRESHOLD=30m  # Refresh when 30 min remaining
```

### Token Refresh Flow

```mermaid
sequenceDiagram
    participant Client
    participant API
    participant Auth
    
    Client->>API: Request with JWT
    API->>Auth: Validate Token
    Auth->>Auth: Check Expiry
    alt Token Valid
        Auth-->>API: Token OK
        API-->>Client: Response
    else Token Near Expiry
        Auth-->>API: Token Valid + Refresh Warning
        API-->>Client: Response + New Token
    else Token Expired
        Auth-->>API: Token Invalid
        API-->>Client: 401 Unauthorized
        Client->>API: Request with Refresh Token
        API->>Auth: Validate Refresh Token
        Auth-->>API: New Access Token
        API-->>Client: New Token Pair
    end
```

## Role-Based Access Control (RBAC)

### Default Roles

ExplorerIO comes with predefined roles that can be customized:

| Role | Description | Default Permissions |
|------|-------------|-------------------|
| `admin` | System administrator | Full system access |
| `analyst` | Data analyst | Data read/write, report creation |
| `viewer` | Read-only user | Data read access only |
| `guest` | Limited access | Public data read only |

### Permission System

Permissions follow a hierarchical structure:

```
resource:action:scope
```

**Examples**:
- `data:read:all` - Read all data
- `data:write:own` - Write to own data only
- `reports:create:team` - Create reports for team
- `users:manage:none` - No user management access

### Custom Roles

Create custom roles through the API or admin interface:

```bash
POST /api/admin/roles
{
  "name": "data_scientist",
  "description": "Data science team member",
  "permissions": [
    "data:read:all",
    "data:write:projects",
    "models:create:team",
    "reports:create:team"
  ]
}
```

## Multi-Factor Authentication (MFA)

### TOTP (Time-based One-Time Password)

Support for authenticator apps like Google Authenticator, Authy, etc.

**Enabling MFA**:
1. User navigates to security settings
2. Scans QR code with authenticator app
3. Enters verification code to confirm setup
4. Backup codes are generated for recovery

**Configuration**:
```bash
MFA_ENABLED=true
MFA_TOTP_ENABLED=true
MFA_ISSUER_NAME=ExplorerIO
MFA_BACKUP_CODES_COUNT=8
```

### SMS Authentication

SMS-based verification codes (requires SMS service integration).

```bash
MFA_SMS_ENABLED=true
SMS_PROVIDER=twilio
SMS_ACCOUNT_SID=your-twilio-sid
SMS_AUTH_TOKEN=your-twilio-token
SMS_FROM_NUMBER=+1234567890
```

## Session Management

### Session Configuration

```bash
# Session settings
SESSION_TIMEOUT=1800  # 30 minutes
SESSION_ABSOLUTE_TIMEOUT=28800  # 8 hours
SESSION_CONCURRENT_LIMIT=3  # Max concurrent sessions
SESSION_SECURE_COOKIES=true
SESSION_SAME_SITE=strict
```

### Session Security Features

1. **Automatic Timeout**: Sessions expire after inactivity
2. **Absolute Timeout**: Hard limit on session duration
3. **Concurrent Session Limits**: Prevent session hijacking
4. **Secure Cookies**: HTTPS-only session cookies
5. **IP Address Binding**: Optional IP validation for sessions

## Security Features

### Password Security

**Password Hashing**:
- Uses bcrypt with configurable rounds
- Salt generated per password
- Automatic rehashing on login if rounds increased

**Password Policies**:
```bash
PASSWORD_MIN_LENGTH=12
PASSWORD_MAX_LENGTH=128
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SYMBOLS=true
PASSWORD_DISALLOW_COMMON=true
PASSWORD_DISALLOW_PERSONAL_INFO=true
PASSWORD_HISTORY_SIZE=5  # Prevent reuse of last 5 passwords
```

### Account Protection

**Rate Limiting**:
```bash
AUTH_RATE_LIMIT_ENABLED=true
AUTH_RATE_LIMIT_MAX_ATTEMPTS=5
AUTH_RATE_LIMIT_WINDOW=300  # 5 minutes
AUTH_RATE_LIMIT_BLOCK_DURATION=900  # 15 minutes
```

**Account Lockout**:
- Temporary lockout after failed attempts
- Progressive lockout duration
- Admin unlock capability
- Automatic unlock after timeout

## API Authentication

### Bearer Token Authentication

```bash
# API request example
GET /api/data
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### API Key Authentication

For service-to-service communication:

```bash
# Generate API key
POST /api/admin/api-keys
{
  "name": "data-sync-service",
  "permissions": ["data:read:all", "data:write:imports"],
  "expires_at": "2024-12-31T23:59:59Z"
}

# Use API key
GET /api/data
X-API-Key: explorerio_ak_1234567890abcdef
```

## User Management

### User Registration

**Self-Registration**:
```bash
REGISTRATION_ENABLED=true
REGISTRATION_REQUIRE_EMAIL_VERIFICATION=true
REGISTRATION_DEFAULT_ROLE=viewer
REGISTRATION_DOMAIN_WHITELIST=company.com,partner.com
```

**Admin-Created Users**:
- Create users through admin interface
- Assign roles and permissions
- Send invitation emails
- Bulk user import from CSV

### User Profile Management

Users can manage their own profiles:
- Update personal information
- Change password
- Manage MFA settings
- View active sessions
- Generate API keys (if permitted)

## Integration Examples

### Frontend Integration

```javascript
// Login function
async function login(username, password) {
  const response = await fetch('/api/auth/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ username, password }),
  });

  if (response.ok) {
    const { token, refreshToken } = await response.json();
    localStorage.setItem('authToken', token);
    localStorage.setItem('refreshToken', refreshToken);
  }
}

// API request with auth
async function apiRequest(url, options = {}) {
  const token = localStorage.getItem('authToken');
  return fetch(url, {
    ...options,
    headers: {
      ...options.headers,
      'Authorization': `Bearer ${token}`,
    },
  });
}
```

### Backend Middleware

```javascript
// Express.js middleware example
const authenticateToken = (req, res, next) => {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) {
    return res.sendStatus(401);
  }

  jwt.verify(token, process.env.JWT_SECRET, (err, user) => {
    if (err) return res.sendStatus(403);
    req.user = user;
    next();
  });
};
```

## Troubleshooting

### Common Authentication Issues

1. **JWT Token Expired**: Implement token refresh logic
2. **CORS Issues**: Configure proper CORS settings for OAuth redirects
3. **LDAP Connection Failed**: Check network connectivity and credentials
4. **OAuth Redirect Mismatch**: Verify redirect URI configuration

### Debugging Authentication

Enable debug logging:
```bash
LOG_LEVEL=debug
AUTH_DEBUG=true
```

Check authentication logs:
```bash
docker-compose logs api | grep "AUTH"
```

## Next Steps

- Explore [Services Integration](services-integration.md) for connecting external systems
- Learn about [Search Functionality](search-functionality.md) with authenticated access
- Check [API Documentation](../api/overview.md) for authentication endpoints
